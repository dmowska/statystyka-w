{
  "hash": "de6e24c4d446573d216f093ce7a9bab0",
  "result": {
    "markdown": "# Testy dla wielu grup \n\n## Testowanie istotność różnic średnich wielu prób\n\n- Parametryczne\n\n    + Jednoczynnikowa analiza wariancji (ANOVA)\n    + Test Tukey'a (HSD)\n\n- Nieparametryczne\n\n    + Test Kruskala-Wallisa\n    + Test Friedmana\n\n## Analiza wariancji \n\n- Celem analizy wariancji (ANOVA) jest zazwyczaj testowanie istotności różnic pomiędzy średnimi w wielu grupach.\n- Służą do oceny czy średnie wartości cechy Y (cecha ilościowa) różnią się istotnie pomiędzy grupami wyznaczonymi przez zmienną X.\n- W analizie jednoczynnikowej badamy zależność pomiędzy cechą Y a jedną zmienną jakościową.\n- Hipoteza zerowa - średnie w grupach są jednakowe: $H_0: \\mu_1 = \\mu_2 = ... \\mu_k$\n- Hipoteza alternatywna: $H_A$: co najmniej dwie średnie różnią się między sobą.\n- Analiza wariancji nie pozwala stwierdzić pomiędzy którymi grupami występują różnice.\n- Aby określić między którymi grupami występują różnice trzeba wykonać porównania wielokrotne (“post-hoc”)\n\n### Podstawowe założenia\n\n- Zmienna w każdej z analizowanych grup ma rozkład zbliżony do rozkładu normalnego.\n- Wariancje w grupach są do siebie podobne.\n- Próby zostały losowo wybrane z populacji.\n\n**Przykład: Czy średnia roczna temperatura powietrza różni się istotnie między prowincjami? **\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npomiary_pol = read.csv(\"data/pomiary_pol.csv\")\npomiary_pol$prow_id = as.factor(pomiary_pol$prow_id)\nsummary(pomiary_pol)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   pomiar_id          tmin_4           tmax_4           tmin_9      \n Min.   :   1.0   Min.   :-4.592   Min.   : 1.824   Min.   : 2.118  \n 1st Qu.: 375.8   1st Qu.: 3.116   1st Qu.:12.505   1st Qu.: 8.500  \n Median : 750.5   Median : 3.515   Median :13.242   Median : 8.886  \n Mean   : 750.5   Mean   : 3.342   Mean   :12.973   Mean   : 8.840  \n 3rd Qu.:1125.2   3rd Qu.: 3.803   3rd Qu.:13.620   3rd Qu.: 9.232  \n Max.   :1500.0   Max.   : 4.894   Max.   :15.100   Max.   :11.248  \n                  NA's   :5        NA's   :5        NA's   :5       \n     tmax_9        annual_tavg     annual_precip       prow_id   \n Min.   : 8.748   Min.   :0.1083   Min.   : 493.0   4      :857  \n 1st Qu.:17.719   1st Qu.:7.1123   1st Qu.: 546.3   6      :179  \n Median :18.340   Median :7.6000   Median : 578.6   2      :175  \n Mean   :18.220   Mean   :7.5828   Mean   : 602.2   5      :163  \n 3rd Qu.:18.847   3rd Qu.:8.2000   3rd Qu.: 636.0   3      : 82  \n Max.   :20.100   Max.   :9.1997   Max.   :1548.8   (Other): 33  \n NA's   :5        NA's   :5        NA's   :5        NA's   : 11  \n     woj_id        prowincja         wojewodztwo       \n Min.   : 0.000   Length:1500        Length:1500       \n 1st Qu.: 4.000   Class :character   Class :character  \n Median : 8.000   Mode  :character   Mode  :character  \n Mean   : 8.448                                        \n 3rd Qu.:13.000                                        \n Max.   :16.000                                        \n NA's   :10                                            \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npomiary_anova = aov(annual_tavg ~ prow_id, data = pomiary_pol)\npomiary_anova\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\n   aov(formula = annual_tavg ~ prow_id, data = pomiary_pol)\n\nTerms:\n                 prow_id Residuals\nSum of Squares  144.4723  794.4199\nDeg. of Freedom        6      1478\n\nResidual standard error: 0.7331416\nEstimated effects may be unbalanced\n15 observations deleted due to missingness\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(pomiary_anova)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n              Df Sum Sq Mean Sq F value Pr(>F)    \nprow_id        6  144.5  24.079    44.8 <2e-16 ***\nResiduals   1478  794.4   0.537                   \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n15 observations deleted due to missingness\n```\n:::\n:::\n\n\n## Test Tukey'a\n\n- Wynikiem testu Tukeya są różnice między średnimi oraz 95% przedział ufności dla tych różnic dla każdej pary porównań.\n- Wynik jest pokazywany w postaci numerycznej i graficznej.\n- Szukamy takich par, dla których przedział ufności średnich nie przecina 0, wskazując na statystycznie istotne różnice między grupami.\n\nGraficzna reprezentacja wyniku – przedziały ufności dla różnic w średnich rocznych temperatur między prowincjami. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nposthoc = TukeyHSD(pomiary_anova, which = \"prow_id\",\n                   conf.level = 0.95)\nposthoc\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  Tukey multiple comparisons of means\n    95% family-wise confidence level\n\nFit: aov(formula = annual_tavg ~ prow_id, data = pomiary_pol)\n\n$prow_id\n           diff         lwr          upr     p adj\n2-1  0.72245605  0.25130020  1.193611892 0.0001312\n3-1  0.98118324  0.47813550  1.484230991 0.0000002\n4-1  1.26183184  0.81384171  1.709821973 0.0000000\n5-1  0.44109716 -0.03233312  0.914527443 0.0868039\n6-1  1.08495890  0.61443838  1.555479424 0.0000000\n7-1  0.89881807  0.05277439  1.744861743 0.0288793\n3-2  0.25872720 -0.03215768  0.549612069 0.1188919\n4-2  0.53937579  0.35978700  0.718964580 0.0000000\n5-2 -0.28135889 -0.51735297 -0.045364807 0.0080791\n6-2  0.36250285  0.13240171  0.592603997 0.0000735\n7-2  0.17636202 -0.56346693  0.916190968 0.9923959\n4-3  0.28064860  0.02901128  0.532285914 0.0175489\n5-3 -0.54008608 -0.83464068 -0.245531483 0.0000015\n6-3  0.10377566 -0.18607904  0.393630350 0.9402837\n7-3 -0.08236518 -0.84290188  0.678171529 0.9999143\n5-4 -0.82073468 -1.00620849 -0.635260866 0.0000000\n6-4 -0.17687294 -0.35478828  0.001042396 0.0525306\n7-4 -0.36301377 -1.08830972  0.362282169 0.7582199\n6-5  0.64386174  0.40913863  0.878584851 0.0000000\n7-5  0.45772091 -0.28355858  1.199000392 0.5325537\n7-6 -0.18614083 -0.92556534  0.553283679 0.9898219\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npar(mar = c(4, 4, 4, 0.1)) # zmiana marginesów\nplot(posthoc, las = 1, cex.axis=0.7)\n```\n\n::: {.cell-output-display}\n![](10_testy_wiele_grup_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n**Wnioski z analizy danych:**\n\nWnioskiem z przeprowadzenia testu post-hoc jest stwierdzenie, że istnieją istotne statystycznie różnice w średniej rocznej temperaturze powietrza między prowincjami: \n\n- Karpaty Wschodnie z Podkarpaciem Wschodnim (1) a pozostałymi (z wyjątkiem 5: Niż Wschodniobałtycko-Białoruski)\n- Karpaty Zachodnie z Podkarpaciem Zachodnim i Północnym (2), a Niż Środkowoeuropejski (4), Niż Wschodniobałtycko-Białoruski (5), Wyżyny Polskie (6)\n- Masyw Czeski (3), a Niż Środkowoeuropejski (4) oraz Niż Wschodniobałtycko-Białoruski (5)\n- Niż Środkowoeuropejski (4), a Niż Wschodniobałtycko-Białoruski (5) oraz Wyżyny Polskie (6)\n- Niż Wschodniobałtycko-Białoruski (5), a Wyżyny Polskie (6)\n\nZestawienie prowincji i ich id\n\n\n::: {.cell}\n\n```{.r .cell-code}\npomiary_pol %>% \n  select(prow_id, prowincja) %>% \n  arrange(prow_id) %>% \n  na.omit() %>% \n  unique()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     prow_id                                              prowincja\n1          1             Karpaty Wschodnie z Podkarpaciem Wschodnim\n25         2 Karpaty Zachodnie z Podkarpaciem Zachodnim i Północnym\n200        3                                           Masyw Czeski\n282        4                                 Niż Środkowoeuropejski\n1139       5                       Niż Wschodniobałtycko-Białoruski\n1302       6                                         Wyżyny Polskie\n1481       7                                      Wyżyny Ukraińskie\n```\n:::\n:::\n\n\n## Test Kruskala-Wallisa\n\n- Nieparametryczną alternatywą dla jednoczynnikowej analizy wariancji stanowi **test Kruskala-Wallisa**. \n- Za pomocą tego testu sprawdzamy, czy *n* niezależnych próbek pochodzi z tej samej populacji, bądź z populacji z taką samą medianą. \n- Statystycznie istotny wynik tego testu informuje, że co najmniej jedna par grup jest różna od siebie\n- Poszczególne próbki nie muszą mieć takiej samej liczebności. \n- Test ten jest rozszerzeniem testu Two sample Wilcoxon dla 3 i więcej grup.\n- Testem post-hoc dla testu Kruskala-Wallisa jest test Dunna (library(dunn.test); ?dunn.test)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(gapminder)\ngapminder2007 = subset(gapminder, year == 2007)\nsummary(gapminder2007)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n        country       continent       year         lifeExp     \n Afghanistan:  1   Africa  :52   Min.   :2007   Min.   :39.61  \n Albania    :  1   Americas:25   1st Qu.:2007   1st Qu.:57.16  \n Algeria    :  1   Asia    :33   Median :2007   Median :71.94  \n Angola     :  1   Europe  :30   Mean   :2007   Mean   :67.01  \n Argentina  :  1   Oceania : 2   3rd Qu.:2007   3rd Qu.:76.41  \n Australia  :  1                 Max.   :2007   Max.   :82.60  \n (Other)    :136                                               \n      pop              gdpPercap      \n Min.   :1.996e+05   Min.   :  277.6  \n 1st Qu.:4.508e+06   1st Qu.: 1624.8  \n Median :1.052e+07   Median : 6124.4  \n Mean   :4.402e+07   Mean   :11680.1  \n 3rd Qu.:3.121e+07   3rd Qu.:18008.8  \n Max.   :1.319e+09   Max.   :49357.2  \n                                      \n```\n:::\n:::\n\n\n**Przykład: Czy oczekiwana dalsza długość życia różni się pomiędzy kontynentami?**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nggplot(gapminder2007, aes(continent, lifeExp)) + geom_boxplot()\n```\n\n::: {.cell-output-display}\n![](10_testy_wiele_grup_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nkruskal.test(lifeExp ~ continent, data = gapminder2007)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tKruskal-Wallis rank sum test\n\ndata:  lifeExp by continent\nKruskal-Wallis chi-squared = 88.095, df = 4, p-value < 2.2e-16\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dunn.test)\ndunn.test(gapminder2007$lifeExp, gapminder2007$continent, kw=FALSE, method=\"bonferroni\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n                           Comparison of x by group                            \n                                 (Bonferroni)                                  \nCol Mean-|\nRow Mean |     Africa   Americas       Asia     Europe\n---------+--------------------------------------------\nAmericas |  -5.536682\n         |    0.0000*\n         |\n    Asia |  -5.132813   0.773586\n         |    0.0000*     1.0000\n         |\n  Europe |  -8.597365  -2.302881  -3.285219\n         |    0.0000*     0.1064    0.0051*\n         |\n Oceania |  -3.449542  -1.548862  -1.844625  -0.704581\n         |    0.0028*     0.6071     0.3255     1.0000\n\nalpha = 0.05\nReject Ho if p <= alpha/2\n```\n:::\n:::\n\nJeśli wartość P.adj jest mniejsza od założonego progu (zazwyczaj 0,05) to hipotezę zerową o braku różnic między grupami można odrzucić na rzecz hipotezy alternatywnej (grupy różnią się).\n\n> Pytanie: Pomiędzy, którymi grupami istnieją statystycznie istotne różnice?\n\n## Test Friedmana\n\nTest wykonywany dla pomiarów powtarzanych (liczba powtórzeń większa od dwóch)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(gapminder)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n        country        continent        year         lifeExp     \n Afghanistan:  12   Africa  :624   Min.   :1952   Min.   :23.60  \n Albania    :  12   Americas:300   1st Qu.:1966   1st Qu.:48.20  \n Algeria    :  12   Asia    :396   Median :1980   Median :60.71  \n Angola     :  12   Europe  :360   Mean   :1980   Mean   :59.47  \n Argentina  :  12   Oceania : 24   3rd Qu.:1993   3rd Qu.:70.85  \n Australia  :  12                  Max.   :2007   Max.   :82.60  \n (Other)    :1632                                                \n      pop              gdpPercap       \n Min.   :6.001e+04   Min.   :   241.2  \n 1st Qu.:2.794e+06   1st Qu.:  1202.1  \n Median :7.024e+06   Median :  3531.8  \n Mean   :2.960e+07   Mean   :  7215.3  \n 3rd Qu.:1.959e+07   3rd Qu.:  9325.5  \n Max.   :1.319e+09   Max.   :113523.1  \n                                       \n```\n:::\n:::\n\n\n**Przykład: Czy oczekiwana dalsza długość życia różni się pomiędzy pomiędzy kolejnymi pomiarami (kolejnymi latami)?**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(gapminder, aes(year, lifeExp, group = country)) + \n  geom_point(color = \"red\") +\n  geom_line()\n```\n\n::: {.cell-output-display}\n![](10_testy_wiele_grup_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfriedman.test(lifeExp ~ year | country, data = gapminder)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tFriedman rank sum test\n\ndata:  lifeExp and year and country\nFriedman chi-squared = 1326.5, df = 11, p-value < 2.2e-16\n```\n:::\n:::\n",
    "supporting": [
      "10_testy_wiele_grup_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}