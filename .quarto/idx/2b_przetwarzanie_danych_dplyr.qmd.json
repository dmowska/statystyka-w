{"title":"Przetwarzanie danych - dplyr","markdown":{"headingText":"Przetwarzanie danych - dplyr","containsRefs":false,"markdown":"\n```{r}\n#| label: pakiety\n#| include: false\nlibrary(gapminder)\nlibrary(dplyr)\nlibrary(tidyr)\n```\n\n## Pakiety\n\n### Pakiet dplyr\n\nPakiet `dplyr` wykorzystuje się do podstawowych operacji przetwarzania danych z wykrzystaniem obiektów typu data.frame. Podstawowe funkcje pakietu to:\n\n-   `select()` - tworzenie podzbioru danych poprzez wybór zmiennych na podstawie ich nazw,\n-   `filter()` - tworzenie podzbioru danych poprzez wybór wierszy na podstawie określonego warunku,\n-   `arrange()` - sortowanie danych,\n-   `mutate()` - tworzenie nowych zmiennych na podstawie określenia warunku,\n-   `summarize()` - podsumowanie danych, np. poprzez obliczenie statystyk podstawowych.\n\nPakiet `dplyr` dostarcza także funkcji:\n\n-   do grupowania danych: `group_by()` - pozwala na wykonanie operacji w podziale na grupy.\n-   do łączenia dwóch lub więcej obiektów (data.frame): `join()`, `left_join()`, `right_join()`\n\nPakiet `dplyr` pozwala także na wykorzystanie operatora łączącego funkcje %\\>%\n\nWięcej informacji:\n\n-   dokumentacja pakietu: <https://dplyr.tidyverse.org/>\n-   podstawowe funkcje pakietu: [\"Cheat Sheet\"](https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf)\n\n### Pakiet tidyr\n\nDane wykorzysywane w analizach muszą być przechowywane w tzw. uporządkowany sposób (ang. *tidy data*). Uporządkowane dane to dane, w których:\n\n-   każda zmienna przechowywana jest w osobnej kolumnie.\n-   każda obserwacja jest zapisana w osobnym wierszu w tabeli danych\n-   każda wartość przechowywana jest w osobnej komórce (tzn. każda komórka przechowuje tylko jedną wartość).\n\nPakiet `tidyr()` zawiera zestaw funkcji, które ułatwiają tworzenie uporządkowanych danych. Uporządkowane dane mogą być przechowywane w dwóch układach: układzie długim i układzie szerokim (więcej informacji w podrozdziale @sec-uklad-danych)\n\nWięcej informacji:\n\n-   dokumentacja: <https://tidyr.tidyverse.org/>\\\n-   cheat sheet: <https://github.com/rstudio/cheatsheets/blob/main/tidyr.pdf>\n\n```{r}\n#| label: wczytanie-danych\n#| include: false\ndata('gapminder', package = 'gapminder')\n```\n\n## Przetwarzanie danych z pakietem `dplyr`\n\n### Funkcja `select()`\n\n-   **Wybór kolumn *country*, *year* oraz *pop*.**\n\n```{r}\n#| label: select-1\n\nsel1 <- select(gapminder, country, year, pop)\nhead(sel1)\n```\n\n> Ze zbioru danych gapminder proszę wybrać dane dla zmiennych country, year oraz lifeExp.\n\n-   **Wybór wszystkich kolumn z wyjątkiem kolumny *kontynent***\n\n```{r}\n#| label: select-2\n\nsel2 <- select(gapminder, -continent)\nhead(sel2)\n```\n\n> Ze zbioru danych gapminder proszę wybrać wszystkie kolumny z wyjątkiem continent oraz gdpPercap.\n\n### Funkcja `filter()`\n\nFunkcja `filter()` służy do tworzenia podzbiorów danych poprzez wybór obserwacji spełniających określone warunki. Warunki są określane za pomocą operatorów logicznych (!=, ==, \\>, \\<, \\>=, \\<=, \\|, &).\n\n-   **Wybór danych dla roku 2007.**\n\n```{r}\n#| label: filter-1\n\nfilt1 <- filter(gapminder, year == 2007)\nhead(filt1)\n```\n\n> Wybierz dane dla kontynentu Europa.\n\n> W jaki inny sposób można wybrać dane dla roku 2007?\n\n-   **Wybór danych dla roku 2007, w których oczekiwana długość trwania życia przekracza 80 lat.**\n\n```{r}\n#| label: filter-2\n\nfilt2 <- filter(gapminder, year == 2007 & lifeExp > 80)\nfilt2\n```\n\n> Wybór danych dla roku 2007, dla wszystkich kontynentów z wyjątkiem Azji, w których oczekiwana długość trwania życia przekracza 80 lat.\n\n### Funkcja `mutate()`\n\nFunkcja `mutate()` służy do tworzenia nowych zmiennych na podstawie określonego wyrażenia\n\n-   **Dodaj kolumnę *abbr_country* zawierającą trzyliterowy kod państwa.**\n\n```{r}\n#| label: mutate-1\n\ngap2 <- mutate(gapminder, abbr_country = toupper(substr(country, 1, 3)))\nhead(gap2)\n```\n\n> Co w powyższym poleceniu robi funkcja `substr()` oraz `toupper()`?\n\n> Dodaj do zbioru danych kolumnę pop_mln zawierająca liczbę ludności w milionach.\n\n### Funkcja `arrange()`\n\nFunkcja `arrange()` wykorzystywana jest do sortowania danych.\n\n-   **Sortowanie rosnące względem zmiennej *lifeExp***\n\n```{r}\n#| label: arrange-1\n\narr1 <- arrange(gapminder, lifeExp)\nhead(arr1)\n```\n\n-   **Sortowanie malejące względem zmiennej *lifeExp***\n\n```{r}\n#| label: arrange-2\n\narr2 <- arrange(gapminder, desc(lifeExp))\nhead(arr2)\n```\n\n> Posortuj dane malejąco względem zmiennej pop.\n\n-   **Sortowanie rosnące względem kontynentu (*continent*) oraz oczekiwanej długości trwania życia (*lifeExp*)**\n\n```{r}\n#| label: arrange-3\narr3 <- arrange(gapminder, continent, lifeExp)\nhead(arr3)\n```\n\n> Posortuj malejąco względem nazwy państwa oraz rosnąco względem liczby ludności.\n\n### Funkcja `rename()`\n\nFunkcja `rename()` służy do zmiany nazw kolumn. W funkcji `rename()` definiujemy *nowa_nazwa = stara_nazwa*.\n\n-   **Zmiana nazw kolumn na polskie nazwy.**\n\n```{r}\n#| label: rename-1\ngap2 <- rename(gapminder, panstwo = country, kontynent = continent, rok = year, dlugosc_zycia = lifeExp, ludnosc = pop, PKB = gdpPercap)\nnames(gap2)\n```\n\n> Korzystając ze strony pomocy funkcji `rename()` sprawdź jak w zmienić nazwy kolumn w obiekcie gap2 na drukowane litery.\n\n### Funkcja `summarize()`\n\nFunkcja `summarize()` służy do wykonywania podsumowań statystycznych. Tworzy kolumny z zadanymi statystykami.\n\n-   **Średnia oczekiwana długość trwania życia.**\n\n```{r}\n#| label: summarize-1\nsmr1 <- summarize(gapminder, \n          srednia = mean(lifeExp))\nsmr1\n```\n\n-   **Średnia, minimalna oraz maksymalna oczekiwana długość trwania życia.**\n\n```{r}\n#| label: summarize-2\nsmr2 <- summarize(gapminder, \n          srednia = mean(lifeExp),\n          min = min(lifeExp),\n          max = max(lifeExp))\nsmr2\n```\n\n> Oblicz średnią, odchylenie standardowe, minimum i maksimum dla zmiennej gdpPercap. \n\n### Grupowanie .by\n\n-   argument .by; np. summarize(, .by) - grupowanie dokonywane tylko na potrzeby danej funkcji\n\n```{r}\n#| label: grupowanie-1\ngrp1 = summarize(filt1 ,\n                 srednia = mean(lifeExp), \n                 .by = continent)\ngrp1\n```\n\n> Oblicz minimalną i maksymalną długość trwania życia w 2007 roku w podziale na kontynenty.\n\n### Funkcja `pull()`\n\nFunkcja `pull()` służy do wyciągania tylko jednej zmiennej\n\n```{r}\n#| label: pull-1\nlife_exp <- pull(gapminder, lifeExp)\nhead(life_exp)\n```\n\n```{r}\n#| label: pull-2\ncontinent <- pull(gapminder, continent)\nhead(continent)\n```\n\n> Wybierz ze zbioru danych kolumnę pop.\n\n### Operator łączący (`%>%`).\n\nUżywając pakietu `dplyr` można łączyć ze sobą funkcje używając operatora `%>%`\n\n#### Przykład\n\nKtóre kraje w roku 1952 miały liczbę ludności powyżej 100 milionów?\n\nAby odpowiedzieć na to pytanie możemy wykonać każdą operację osobno, i jej wynik zapisać w osobnym obiekcie. Operator łączący `%>%` pozwala natomiast na przekazanie wyniku działania jednej funkcji do drugiej, bez tworzenia osobnych obiektów.\n\n```{r}\n#| label: kilka-fnc\nf1 <- filter(gapminder, pop > 100000000 & year == 1952)\ns1 <- select(f1, country, pop)\na1 <- arrange(s1, pop) # sortowanie danych wzgledem pop\na1\n```\n\n-   **Wykorzystanie operatora łączącego `%>%`**\n\n```{r}\n#| label: operator\ndf <- gapminder %>%  #wejsciowy zbior danych\n  filter(pop > 100000000 & year == 1952) %>% # wybor krajow z pop > 100mln w roku 1952\n  select(country, pop) %>% # wybor kolumn country, pop \n  arrange(pop) # sortowanie danych wzgledem pop\n\ndf\n```\n\n> Które kraje w 2007 roku miały populację powyżej 100 milionów? Posortuj wynik od krajów z największą liczbą ludności do krajów z najmniejszą liczbą ludności.\n\n### Funkcja `join()`\n\n```{r}\nx <- data.frame(country = c(\"Poland\", \"USA\", \"Germany\"), pop = c(36.82, 333.3, 83.8))\n\ny = data.frame(country = c(\"Poland\", \"USA\", \"Italy\"), pop = c(36.82, 333.3, 58.94))\n```\n\n```{r}\nx\n```\n\n```{r}\ny\n```\n\n-   Funkcja `inner_join(x, y)` zwraca tylko obiekty występujące w obu tabelach\n\n```{r}\n#| label: inner-join\ninner_df <- inner_join(x, y, by = 'country')\ninner_df \n```\n\n-   Funkcja `left_join(x, y)` zachowuje wszystkie obserwacje w x, niezależnie od tego, czy mają swój odpowiednik w tabeli y. Jest to najczęściej używane łączenie, ponieważ gwarantuje, że nie utracimy obserwacji z tabeli podstawowej (x).\n\n```{r}\n#| label: left-join\nleft_df <- left_join(x, y, by = 'country')\nleft_df\n```\n\n-   Funkcja `right_join(x, y)` zachowuje wszystkie obserwacje w y.\n\n```{r}\n#| label: right-join\nright_df <- right_join(x, y, by = 'country')\nright_df\n```\n\n-   Funkcja `full_join(x, y)` zwraca wszystkie obiekty z tabeli x oraz z tabeli y.\n\n```{r}\n#| label: full-join\nfull_df <- full_join(x, y, by = 'country')\nfull_df\n```\n\n## Układ danych {#sec-uklad-danych}\n\nDane w tabeli mogą być zapisywane w układzie **długim** lub **szerokim**.\n\n![Układ danych (po lewej) - szeroki; (po prawej) długi](figures/2_wide_long.png)\n\nZmiana układu danych jest możliwa z użyciem funkcji z pakietu `tidyr`.\n\n```{r}\n#| label: tidyr\nlibrary(tidyr)\n```\n\n-   **Układ długi**\n\nDane gapminder są zapisane w układzie długim:\n\n```{r}\nhead(gapminder, 10)\n```\n\n-   **Układ szeroki**\n\nFunkcja `pivot_wider()` przekształca dane z formatu długiego w szeroki. Obiekt gapminder_wide w każdej kolumnie przechowuje dane dla jednego roku, a w każdym wierszu dla kraju.\n\n```{r}\n#| label: pivot-wider\ngapminder2 <- select(gapminder, -continent, \n                    -lifeExp, -gdpPercap)\ngapminder_wide <- pivot_wider(gapminder2, \n                             names_from = year, \n                             values_from = pop)\n\nhead(gapminder_wide)\n```\n\n> Wybierz z danych kolumnę lifeExp oraz year i zamień dane na układ szeroki. \n\n-   **Układ szeroki -\\> Układ długi**\n\n```{r}\n#| label: pivot-longer\n#| include: false\ngapminder_long <- pivot_longer(gapminder_wide,\n                              cols = colnames(gapminder_wide)[-1])\ngapminder_long \n```\n\n> Wybierz z danych kolumnę gdpPercap oraz year i zamień dane na układ szeroki. Następnie z układu szerokiego zamień dane na układ długi.  ","srcMarkdownNoYaml":""},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","output-file":"2b_przetwarzanie_danych_dplyr.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.3.450","bibliography":["references.bib"],"editor":"visual","number-depth":3,"theme":"cosmo","out-width":"400px"},"extensions":{"book":{"multiFile":true}}},"pdf":{"identifier":{"display-name":"PDF","target-format":"pdf","base-format":"pdf"},"execute":{"fig-width":5.5,"fig-height":3.5,"fig-format":"pdf","fig-dpi":300,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"pdf","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":true,"merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"pdf-engine":"xelatex","standalone":true,"variables":{"graphics":true,"tables":true},"default-image-extension":"pdf","to":"pdf","output-file":"2b_przetwarzanie_danych_dplyr.pdf"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"block-headings":true,"bibliography":["references.bib"],"editor":"visual","number-depth":3,"documentclass":"scrreprt"},"extensions":{"book":{"selfContainedOutput":true}}}},"projectFormats":["html","pdf"]}